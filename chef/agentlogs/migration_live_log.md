# Migration Live Log

Use this temporary handoff file during migrations/deployments. Keep entries brief and append-only.

- 2026-02-23T20:37:58Z | branch=main(redeploy-main-20260223b) | commit=pending | service=chef-bot(us-central1) | result=patched per-turn mode persistence + /restart media backfill always-on | next=commit, deploy, and verify Cloud Run logs while user tests in Telegram
- 2026-02-23T22:21:25Z | branch=hotfix-image-latency | commit=pending | service=chef-bot(us-central1) | result=patched base instructions to re-enable media analysis; made firebase metadata write async; hardened stream status send timeout path | next=commit/push/deploy and validate image + latency logs on prod
- 2026-02-23T22:26:18Z | branch=hotfix-image-latency | commit=pending | service=chef-bot(us-central1) | result=added photo pipeline timeout/fallback in telegram_bot to prevent hangs on get_file/download timeout | next=commit/push/redeploy and verify image turn logs
- 2026-02-23T22:53:23Z | branch=hotfix-image-latency | commit=pending | service=chef-bot(us-central1) | result=patched media description pipeline: fallback to ai_description when no candidate text; continue scanning all sessions; unsilenced vision listener subprocess logs | next=commit/push/deploy and verify user_description_saved_from_ai + vision listener logs
- 2026-02-23T23:00:09Z | branch=main(hotfix-image-latency) | commit=2d4a84e | gha_run=22328384790 | service=chef-bot(us-central1) rev=chef-bot-00017-heb traffic=100 | result=deployed backfill fix and removed extra services (chefdev/chevdev) | evidence=gcloud run services list + gha run status | next=validate live telegram image/log behavior and patch general media instruction follow-through
- 2026-02-23T23:01:32Z | branch=main(hotfix-image-latency) | commit=a5e908e | gha_run=22328523313 | service=chef-bot(us-central1) | result=failed pre-deploy due Docker Hub 504 on base image metadata pull | next=push no-op/log commit to retrigger deploy
- 2026-02-23T23:09:45Z | branch=main(hotfix-image-latency) | commit=pending | service=chef-bot(us-central1) | result=patched photo pipeline with hard async timeout wrappers around get_file + download_to_drive | next=push/deploy and verify with live webhook photo probe + Cloud Run logs
- 2026-02-23T23:10:36Z | branch=main(hotfix-image-latency) | commit=pending | service=chef-bot(us-central1) | result=added media_user_error early-return path so photo failures are surfaced to user and do not continue into model/stream path | next=push/deploy and validate with failing photo probe
- 2026-02-23T23:19:34Z | branch=main(hotfix-image-latency) | commit=pending | gha_run=pending | service=chef-bot(us-central1) | result=added dev-vs-main triage protocol in AGENTS, enabled Cloud Run --no-cpu-throttling in workflow, and hardened media error reply exception handling | evidence=main webhook 200 + dev webhook 404 comparison, Mongo/media log checks | next=push/deploy and verify ai_description/user_description updates from live image turn without manual script
- 2026-02-23T23:21:51Z | branch=main(hotfix-image-latency) | commit=pending | service=chef-bot(us-central1) | result=disabled on-ingest vision spawn by default (MEDIA_ANALYZE_ON_INGEST=0), so chat turns only log metadata and /restart backfill handles enrichment | next=push/deploy and verify logs show ingest_enrichment=deferred_to_restart
- 2026-02-23T23:26:29Z | branch=main(hotfix-image-latency) | commit=3988200 | gha_run=22329175387 | service=chef-bot(us-central1) rev=chef-bot-00022-wiv traffic=100 | result=deferred live-turn enrichment; /restart background backfill populated media descriptions; dev webhook still 404 while main webhook healthy | evidence=Cloud Run logs 23:25-23:26 + Mongo media_metadata latest doc has_ai/has_user true | next=have user validate in real Telegram chat and monitor logs
- 2026-02-23T23:28:11Z | branch=main(hotfix-image-latency) | commit=pending | service=chef-bot(us-central1) | result=photo upload failure now maps to media_user_error + early return; no broken [Photo saved locally] model turn | next=push/deploy and verify logs
